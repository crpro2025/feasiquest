<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FeasiQuest - My Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .user-details h2 {
            margin: 0 0 5px 0;
            color: #1e293b;
        }

        .user-details p {
            margin: 0;
            color: #64748b;
            font-size: 14px;
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
        }

        .dashboard-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            margin: 0 0 15px 0;
            color: #64748b;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);
            transition: width 0.5s ease;
        }

        .insights-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .insights-section h2 {
            margin: 0 0 20px 0;
            color: #1e293b;
        }

        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .insight-card {
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
        }

        .insight-card h4 {
            margin: 0 0 10px 0;
            color: #1e293b;
            font-size: 16px;
        }

        .insight-card p {
            margin: 0;
            color: #64748b;
            font-size: 14px;
            line-height: 1.6;
        }

        .activity-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: #eff6ff;
        }

        .activity-details {
            flex: 1;
        }

        .activity-details h4 {
            margin: 0 0 5px 0;
            color: #1e293b;
            font-size: 14px;
        }

        .activity-details p {
            margin: 0;
            color: #64748b;
            font-size: 12px;
        }

        .recommendations-section {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .recommendations-section h2 {
            margin: 0 0 20px 0;
        }

        .recommendation-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .recommendation-card h4 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .recommendation-card p {
            margin: 0 0 15px 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .recommendation-card button {
            background: white;
            color: #dc2626;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .chart-container {
            margin-top: 20px;
            height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-details">
                    <h2 id="userName">Loading...</h2>
                    <p id="userEmail"></p>
                    <p id="memberSince"></p>
                </div>
            </div>
            <div class="dashboard-actions">
                <button class="btn-primary" onclick="goToTraining()">Continue Training</button>
                <button class="btn-secondary" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3>Completion Progress</h3>
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">
                    <span id="completedModules">0</span> of 9 modules completed
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-card">
                <h3>Experience Points</h3>
                <div class="stat-value" id="xpValue">0</div>
                <div class="stat-label">
                    Level <span id="levelValue">1</span> • <span id="badgesValue">0</span> badges earned
                </div>
            </div>

            <div class="stat-card">
                <h3>Average Score</h3>
                <div class="stat-value" id="avgScore">0%</div>
                <div class="stat-label">Across all assessments</div>
            </div>

            <div class="stat-card">
                <h3>Learning Velocity</h3>
                <div class="stat-value" id="velocity">0</div>
                <div class="stat-label">modules per week</div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="recommendations-section">
            <h2>🤖 AI Recommendations</h2>
            <div id="recommendationsContainer">
                <div class="recommendation-card">
                    <h4>Loading personalized recommendations...</h4>
                </div>
            </div>
        </div>

        <!-- Insights -->
        <div class="insights-section">
            <h2>📊 Your Learning Insights</h2>
            <div class="insight-grid" id="insightsGrid">
                <div class="insight-card">
                    <h4>Loading insights...</h4>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-section">
            <h2>Recent Activity</h2>
            <div id="activityContainer">
                <div class="activity-item">
                    <div class="activity-icon">📚</div>
                    <div class="activity-details">
                        <h4>Loading activity...</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="dashboard.js"></script>
    <script src="ai-advanced.js"></script>
    <script>
        // Check authentication
        if (!authSystem.isAuthenticated()) {
            window.location.href = 'auth-ui.html';
        }

        // Load dashboard data
        function loadDashboard() {
            const dashboardData = dashboardSystem.getUserDashboard();
            
            if (!dashboardData.success) {
                alert('Error loading dashboard');
                return;
            }

            const data = dashboardData.dashboard;

            // Update user info
            document.getElementById('userName').textContent = data.user.name;
            document.getElementById('userEmail').textContent = data.user.email;
            document.getElementById('memberSince').textContent = `Member since ${data.user.memberSince}`;
            
            const avatar = document.getElementById('userAvatar');
            avatar.textContent = data.user.avatar.initials;
            avatar.style.backgroundColor = data.user.avatar.color;

            // Update stats
            document.getElementById('completionRate').textContent = data.progress.completionPercentage + '%';
            document.getElementById('completedModules').textContent = data.progress.completedModules;
            document.getElementById('progressFill').style.width = data.progress.completionPercentage + '%';
            document.getElementById('xpValue').textContent = data.progress.xp.toLocaleString();
            document.getElementById('levelValue').textContent = data.progress.level;
            document.getElementById('badgesValue').textContent = data.progress.badges;
            document.getElementById('avgScore').textContent = data.progress.averageScore + '%';
            document.getElementById('velocity').textContent = data.insights.learningVelocity;

            // Load AI recommendations
            loadRecommendations(data);

            // Load insights
            loadInsights(data);

            // Load activity
            loadActivity(data);
        }

        function loadRecommendations(data) {
            const container = document.getElementById('recommendationsContainer');
            
            let html = '';

            // Next module recommendation
            if (data.insights.nextModule.id) {
                html += `
                    <div class="recommendation-card">
                        <h4>📚 Continue Your Journey</h4>
                        <p>Next recommended: ${data.insights.nextModule.name}</p>
                        <button onclick="goToModule(${data.insights.nextModule.id})">Start Module</button>
                    </div>
                `;
            }

            // Predicted completion
            if (data.insights.predictedCompletion !== 'Completed!' && data.insights.predictedCompletion !== 'Not enough data') {
                html += `
                    <div class="recommendation-card">
                        <h4>🎯 Completion Forecast</h4>
                        <p>At your current pace, you'll complete the certification by ${data.insights.predictedCompletion}</p>
                        <button onclick="showDetailedAnalytics()">View Analytics</button>
                    </div>
                `;
            }

            // Areas for improvement
            if (data.insights.areasForImprovement.length > 0) {
                const area = data.insights.areasForImprovement[0];
                html += `
                    <div class="recommendation-card">
                        <h4>💡 Strengthen Your Skills</h4>
                        <p>Focus on ${area.module} (Score: ${area.score}%)</p>
                        <button onclick="reviewModule('${area.module}')">Review Module</button>
                    </div>
                `;
            }

            container.innerHTML = html || '<div class="recommendation-card"><h4>Great job! Keep up the excellent work! 🌟</h4></div>';
        }

        function loadInsights(data) {
            const container = document.getElementById('insightsGrid');
            
            let html = '';

            // Success prediction
            const prediction = advancedAI.predictSuccess(authSystem.getCurrentUser());
            html += `
                <div class="insight-card">
                    <h4>🎯 Success Prediction</h4>
                    <p>${prediction.message}</p>
                </div>
            `;

            // Learning velocity
            html += `
                <div class="insight-card">
                    <h4>⚡ Learning Pace</h4>
                    <p>You're completing ${data.insights.learningVelocity} modules per week. ${data.insights.learningVelocity >= 1 ? 'Great pace!' : 'Consider increasing study time.'}</p>
                </div>
            `;

            // Strengths
            if (data.insights.strengths.length > 0) {
                const strength = data.insights.strengths[0];
                html += `
                    <div class="insight-card">
                        <h4>💪 Top Strength</h4>
                        <p>${strength.module}: ${strength.score}% - Excellent mastery!</p>
                    </div>
                `;
            }

            // Time spent
            html += `
                <div class="insight-card">
                    <h4>⏱️ Time Investment</h4>
                    <p>Total study time: ${data.progress.totalTimeSpent}</p>
                </div>
            `;

            container.innerHTML = html;
        }

        function loadActivity(data) {
            const container = document.getElementById('activityContainer');
            
            if (data.recentActivity.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">No recent activity</p>';
                return;
            }

            let html = '';
            data.recentActivity.forEach(activity => {
                const icon = activity.type === 'module_completed' ? '✅' : '🏆';
                html += `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-details">
                            <h4>${activity.description}</h4>
                            <p>${new Date(activity.timestamp).toLocaleDateString()}</p>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function goToTraining() {
            window.location.href = 'index.html';
        }

        function goToModule(moduleId) {
            // Store the module to start
            localStorage.setItem('startModule', moduleId);
            window.location.href = 'index.html';
        }

        function showDetailedAnalytics() {
            alert('Detailed analytics coming soon!');
        }

        function reviewModule(moduleName) {
            alert(`Review ${moduleName} - Feature coming soon!`);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                authSystem.logout();
                window.location.href = 'auth-ui.html';
            }
        }

        // Load dashboard on page load
        loadDashboard();
    </script>
</body>
</html>